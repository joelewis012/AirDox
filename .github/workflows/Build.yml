name: Build AirDox (Momentum Dev)

on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout AirDox repo
      uses: actions/checkout@v4

    - name: Install build dependencies
      run: |
        sudo apt update
        sudo apt install -y \
          python3 \
          python3-pip \
          git \
          build-essential \
          libusb-1.0-0

    - name: Clone Momentum firmware (dev)
      run: |
        git clone --depth 1 https://github.com/Next-Flip/Momentum-Firmware.git flipperzero-firmware

    - name: Copy AirDox app into firmware
      run: |
        mkdir -p flipperzero-firmware/applications_user/air_dox
        cp applications_user/air_dox/* flipperzero-firmware/applications_user/air_dox/

    - name: Build AirDox FAP
      run: |
        cd flipperzero-firmware
        ./fbt fap_air_dox

    - name: Upload AirDox FAP
      uses: actions/upload-artifact@v4
      with:
        name: air_dox_fap
        path: flipperzero-firmware/build/**/*.fap
